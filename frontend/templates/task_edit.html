{% extends "base.html" %}
{% block content %}

<h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
<p class="muted small">ID: {{ task.get("_id") }}</p>

<form class="box" method="post" action="{{ url_for('task_edit_submit', task_id=task.get('_id')) }}">
  <!-- —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Ç–æ—Ç –∂–µ –ø–µ—Ä–∏–æ–¥ -->
  <input type="hidden" name="view" value="{{ view }}">
  <input type="hidden" name="date" value="{{ d }}">

  <label>–ù–∞–∑–≤–∞–Ω–∏–µ
    <input name="title" value="{{ task.get('title','') }}">
  </label>

  <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1..5)
    <input name="priority" type="number" min="1" max="5" value="{{ task.get('priority',3) }}">
  </label>

  <label>–°—Ä–æ–∫ (ISO –≤ —Å–ø–∏—Å–∫–µ, –Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ datetime-local)
    <input name="due_date" type="datetime-local">
    <div class="muted small">–¢–µ–∫—É—â–∏–π: {{ task.get("due_date") or "-" }}</div>
  </label>

  <label>–û–ø–∏—Å–∞–Ω–∏–µ
    <textarea name="description" rows="4">{{ task.get('description','') }}</textarea>
  </label>

  <label>–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
    <input name="tags" value="{{ (task.get('tags') or []) | join(', ') }}">
  </label>

  <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
    <input name="comment" value="{{ task.get('comment','') }}">
  </label>

  <label class="row">
    <!-- hidden + checkbox => –º–æ–∂–Ω–æ –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å –∏ true –∏ false -->
    <input type="hidden" name="done" value="0">
    <input type="checkbox" name="done" value="1" {{ "checked" if task.get("done") else "" }}>
    <span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
  </label>

  <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞—á—É</button>
</form>

<h3>–ü–æ–¥–∑–∞–¥–∞—á–∏</h3>

{% set subs = task.get("subtasks") or [] %}
{% if not subs %}
  <p class="muted">–ü–æ–¥–∑–∞–¥–∞—á –Ω–µ—Ç.</p>
{% else %}
  <div class="sublist">
    {% for s in subs %}
      <div class="subrow">
        <form class="row" method="post" action="{{ url_for('subtask_edit', task_id=task.get('_id'), subtask_id=s.get('subtask_id')) }}">
          <input type="hidden" name="view" value="{{ view }}">
          <input type="hidden" name="date" value="{{ d }}">

          <input name="title" value="{{ s.get('title','') }}" class="subtitle">

          <label class="row">
            <input type="hidden" name="sub_done" value="0">
            <input type="checkbox" name="sub_done" value="1" {{ "checked" if s.get("done") else "" }}>
            <span class="muted small">done</span>
          </label>

          <button type="submit">üíæ</button>
        </form>

        <form method="post" action="{{ url_for('subtask_delete', task_id=task.get('_id'), subtask_id=s.get('subtask_id')) }}">
          <input type="hidden" name="view" value="{{ view }}">
          <input type="hidden" name="date" value="{{ d }}">
          <button type="submit">‚àí</button>
        </form>
      </div>
    {% endfor %}
  </div>
{% endif %}

<form class="box row" method="post" action="{{ url_for('subtask_add', task_id=task.get('_id')) }}">
  <input type="hidden" name="view" value="{{ view }}">
  <input type="hidden" name="date" value="{{ d }}">

  <input name="title" placeholder="–ù–æ–≤–∞—è –ø–æ–¥–∑–∞–¥–∞—á–∞..." class="grow">
  <button type="submit">+</button>
</form>

<div class="row" style="margin-top:12px;">
  <a class="btn" href="{{ url_for('tasks_list', view=view, date=d) }}">–ù–∞–∑–∞–¥</a>
</div>

{% endblock %}
